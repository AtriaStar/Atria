@page "/newWse"
@using Microsoft.AspNetCore.Components
@using Models

<PageTitle>Atria - NewWse</PageTitle>

<div class="container-lg mt-3">

    @*TODO: draft only needs name; to publish name, short description and link needed*@
    <EditForm Model="@webserviceEntry" OnValidSubmit="HandleValidSubmit">
        <DataAnnotationsValidator/>
        <ValidationSummary/>

        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <div class="btn-group d-flex justify-content-end">
                <button class="btn-green" type="submit">
                    Als Entwurf speichern
                </button>
            </div>
            <div class="btn-group d-flex justify-content-end">
                <button class="btn-green" type="submit">
                    Veröffentlichen
                </button>
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label fw-bold">Name</label>
            <div class="input-field">
                <InputText class="form-control" id="name" @bind-Value="webserviceEntry.Name"/>
            </div>
            <ValidationMessage For="() => webserviceEntry.Name"></ValidationMessage>
        </div>

        <div class="mb-3">
            <label class="form-label fw-bold">Kurzbeschreibung</label>
            <div class="input-field">
                <InputText class="form-control" id="shortDescription" @bind-Value="webserviceEntry.ShortDescription"/>
            </div>
            <ValidationMessage For="() => webserviceEntry.ShortDescription"></ValidationMessage>
        </div>

        <div class="row">
            <div class="col-auto">
                <label class="form-label fw-bold">
                    Tags
                </label>
            </div>
            <div class="col-auto d-flex justify-content-end">
                <div class="btn-group">
                    <button class="btn-red" type="button" @onclick="() => deleteSelectedTags()">
                        Alle Löschen
                    </button>
                </div>
            </div>
        </div>
        
        <div class="row mb-1">
            @foreach (string tag in selectedTags)
            {
                <div class="col-auto">
                    <h6>
                        <span class="badge bg-info">
                            @tag
                            <button type="button" class="btn-close btn-close-white" aria-label="Close" @onclick="() => removeTag(tag)"/>
                        </span>
                    </h6>
                </div>
            }
        </div>
        
        <select class="form-select mb-3" size="8" multiple @onchange="SelectedCarsChanged">
            @for (int i = 0; i < 21; i++) {
                <option value="Tag @i">Tag @i</option>
            }
        </select>

        <div class="mb-3">
            <label class="form-label fw-bold">
                neue Tags erstellen
                <small class="text-muted">(kommagetrennt)</small>
            </label>
            <div class="input-field">
                <InputTextArea class="form-control" rows="3" id="newTags" @bind-Value="webserviceEntry.NewTags"/>
            </div>
            <ValidationMessage For="() => webserviceEntry.NewTags"></ValidationMessage>
        </div>

        <div class="mb-3">
            <label class="form-label fw-bold">Verlinkung</label>
            <div class="input-field">
                <InputText class="form-control" type="url" id="link" @bind-Value="webserviceEntry.Link"/>
            </div>
            <ValidationMessage For="() => webserviceEntry.Link"></ValidationMessage>
        </div>

        <div class="mb-3">
            <label class="form-label fw-bold">Dokumentation</label>
            <div class="input-field">
                <InputText class="form-control mb-2" type="url" placeholder="Link" id="docLink" @bind-Value="webserviceEntry.DocumentationLink"/> 
            </div>
            <div class="input-field">
                <InputTextArea class="form-control" rows="3" placeholder="Text" id="doc" @bind-Value="webserviceEntry.Documentation"/>
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label fw-bold">Volltextbeschreibung</label>
            <div class="input-field">
                <InputTextArea class="form-control" rows="3" id="fullDescription" @bind-Value="webserviceEntry.FullDescription"/>
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label fw-bold">Änderungshistorie</label>
            <div class="input-field">
                <InputTextArea class="form-control" rows="3" id="changeLog" @bind-Value="webserviceEntry.ChangeLog"/>
            </div>
        </div>

        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <div class="btn-group d-flex justify-content-end">
                <button class="btn-green" type="submit">
                    Als Entwurf speichern
                </button>
            </div>
            <div class="btn-group d-flex justify-content-end">
                <button class="btn-green" type="submit">
                    Veröffentlichen
                </button>
            </div>
        </div>
    </EditForm>
</div>

@code {
    readonly WebserviceEntry webserviceEntry = new();
    /*string[] selectedTags = new [] { "Tag 1", "Tag 2", "Tag 3", "Tag 4", "Tag very very long tag 1", "Tag 6", "Tag 7", "Tag 8", "Tag 9", "Tag very very long tag 2", "Tag very very long tag 3", "Tag very very long tag 4" };*/
    string[] selectedTags = new string[] { };

    private void HandleValidSubmit() {
        Console.WriteLine("Valid");
    }

    private void deleteSelectedTags()
    {
        selectedTags = Array.Empty<string>();
    }

    private void removeTag(string tag)
    {
        selectedTags = selectedTags.Where(w => w != tag).ToArray();
    }

    private void SelectedCarsChanged(ChangeEventArgs e)
    {
        if (e.Value is not null)
        {
            selectedTags = (string[])e.Value;
        }
    }
}