@using Frontend.Pages.WSE
@using Models
@using RichardSzalay.MockHttp
@inherits TestContext

@code {

    private async Task Setup(bool isAuthorized) {
        var mockHttpHandler = Services.AddMockHttpClient();
        await MockAuthentication.AddMockAuthentication(this, mockHttpHandler, isAuthorized);
        var navMan = Services.GetRequiredService<FakeNavigationManager>();
        navMan.NavigateTo("/wse/1");
        WebserviceEntry entry = new WebserviceEntry() {
            Name = "Google",
            ShortDescription = "A Search Engine",
            Link = "https://www.google.com/",
            ContactPersonId = 1,
            Id = 1,
        };
        mockHttpHandler.When("/wse/1").RespondJson(entry);
        mockHttpHandler.When("/user/1").RespondJson(MockAuthentication.GetMockUser());
        mockHttpHandler.When("/wse/1/review/count").RespondJson(0);
        mockHttpHandler.When("/wse/1/question/count").RespondJson(0);
        mockHttpHandler.When("/wse/1/collaborators").RespondJson(MockAuthentication.GetMockUser());
    }

    [Fact]
    public async Task DisplayWse() {
        await Setup(false);

        var cut = RenderComponent<WseDetail>(builder => builder
            .Add(parameter => parameter.WseId, 1)
            .Add(parameter => parameter.WseName, "Google"));
        cut.WaitForState(() => cut.Find(".card-title").TextContent.Equals("Google"));
        var wseName = cut.Find(".card-title");
        var wseLink = cut.Find("a[title='Zum Webservice']");

        Assert.Equal("Google", wseName.InnerHtml);
        Assert.Contains(wseLink.Attributes, attr
            => attr.Name.Equals("href") && attr.Value.Equals("https://www.google.com/"));
    }

}
